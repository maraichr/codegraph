# Contributing to Lattice

Thank you for your interest in contributing to Lattice! This document provides guidelines for contributing to the project.

## Development Workflow

1. **Fork** the repository and clone your fork
2. **Create a branch** from `main` for your work: `git checkout -b feature/my-feature`
3. **Make your changes** with clear, focused commits
4. **Run tests and linting** before submitting
5. **Open a Pull Request** against `main`

## Prerequisites

- **Go 1.25+**
- **Node.js 22+** with pnpm
- **Docker** and Docker Compose (for infrastructure services)

## Getting Started

```bash
# Start infrastructure
docker compose up -d

# Run tests
make test

# Run linting
make lint

# Build all binaries
make build
```

## Code Generation

This project uses code generation for database queries (SQLC) and GraphQL resolvers (gqlgen). After modifying SQL queries or GraphQL schema:

```bash
make generate          # Run all code generation
make generate-sqlc     # SQLC only (after changing internal/store/postgres/queries/*.sql)
make generate-graphql  # gqlgen only (after changing internal/api/graphql/schema.graphqls)
```

Do not manually edit generated files:
- `internal/store/postgres/*.sql.go` (generated by SQLC)
- `internal/api/graphql/generated.go` (generated by gqlgen)

## Running Tests

```bash
# All tests with race detection
make test

# With coverage
make test-coverage

# Specific package
go test ./internal/parser/tsql/... -v
```

## Commit Conventions

- Use clear, descriptive commit messages
- Start with a verb in imperative mood: `Add`, `Fix`, `Update`, `Remove`, `Refactor`
- Keep the first line under 72 characters
- Reference issues when applicable: `Fix symbol resolution for nested CTEs (#42)`

Examples:
```
Add column lineage tracking for T-SQL MERGE statements
Fix Neo4j connection pool exhaustion under concurrent indexing
Update SQLC queries for incremental file upsert
```

## Code Style

- **Go**: Follow standard Go conventions. Run `make fmt` and `make lint` before committing.
- **TypeScript/React**: Biome is used for linting and formatting. Run `cd frontend && pnpm biome check src/`.
- **SQL**: Use lowercase keywords, snake_case for identifiers.

## Adding a New Parser

1. Create a package under `internal/parser/<language>/`
2. Implement the `parser.Parser` interface
3. Register file extensions in the parser registry (`internal/parser/registry.go`)
4. Add tests with representative source files in `testdata/`

## Pull Request Guidelines

- Keep PRs focused â€” one feature or fix per PR
- Include tests for new functionality
- Update documentation if behavior changes
- Ensure CI passes before requesting review

## Reporting Issues

Use [GitHub Issues](https://github.com/maraichr/lattice/issues) with the provided templates. Include:
- Steps to reproduce
- Expected vs. actual behavior
- Go version, OS, and relevant environment details

## License

By contributing, you agree that your contributions will be licensed under the [MIT License](LICENSE).
